<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Delightful Notes</title>
		<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
		<link href="styles.css" rel="stylesheet">
	</head>
	<body>
		<div class="container">
			<h1 class="title">Delightful Notes</h1>
			<hr class="divider">
			<div id="notes-container" class="notes-container">
				<div id="notes-list" class="notes-list"></div>
			</div>
			<button id="write-btn" class="write-btn" aria-label="Write Note">✍️</button>
			<div id="write-modal" class="write-modal">
				<div class="modal-content">
					<h2 class="modal-title">New Note</h2>
					<textarea id="note-input" class="note-input" rows="5" placeholder="Nothing but creativity"></textarea>
					<div class="modal-footer">
						<div class="visibility-toggle">
							<input type="checkbox" id="visibility-checkbox" checked/>
							<label for="visibility-checkbox">Visible</label>
						</div>
						<button id="save-btn" class="save-btn">Save Note</button>
					</div>
				</div>
			</div>
		</div>
		<script type="module">
			import{initializeApp} from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
			import{getFirestore, collection, addDoc, getDocs, query, where, orderBy,} from "https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js";
			const firebaseConfig=
			{
				apiKey: "AIzaSyBIsQtSpCCA1QDks8K6WpDe1jXppMtwVOs",
				authDomain: "notes-81643.firebaseapp.com",
				projectId: "notes-81643",
				storageBucket: "notes-81643.appspot.com",
				messagingSenderId: "896217476176",
				appId: "1:896217476176:web:02bb0d8fe5dae50519f555",
				measurementId: "G-PVHEPSRWML",
			};
			const app=initializeApp(firebaseConfig);
			const db=getFirestore(app);
			const writeBtn=document.getElementById("write-btn");
			const writeModal=document.getElementById("write-modal");
			const noteInput=document.getElementById("note-input");
			const saveBtn=document.getElementById("save-btn");
			const visibilityCheckbox=document.getElementById("visibility-checkbox");
			const notesList=document.getElementById("notes-list");
			writeBtn.addEventListener("click", ()=>
				{
					writeModal.classList.add("show");
				});
			document.addEventListener("click", (e)=>
				{
					if(e.target!==writeModal && e.target!==writeBtn && !writeModal.contains(e.target))
					{
						writeModal.classList.remove("show");
					}
				});
			saveBtn.addEventListener("click", async()=>
				{
					const noteContent=noteInput.value.trim();
					if(noteContent==="Life")
					{
						await loadNotes(true);
					}
					else if(noteContent!=="")
					{
						const isVisible=visibilityCheckbox.checked?"visible":"hidden";
						await addDoc(collection(db, "notes"),
							     {
								     content: noteContent, visibility: isVisible, date: formatDate(new Date()), timestamp: new Date(),
							     });
						await loadNotes(false);
					}
					noteInput.value="";
					visibilityCheckbox.checked=true;
					writeModal.classList.remove("show");
				});
			function formatDate(date)
			{
				const day=date.getDate();
				const month=date.getMonth()+1;
				const year=date.getFullYear();
				const hours=date.getHours();
				const minutes=date.getMinutes().toString().padStart(2, "0");
				const ampm=hours>=12?"p.m.":"a.m.";
				const hours12=hours%12 || 12;
				return `${day}.${month}.${year} ${hours12}:${minutes} ${ampm}`;
			}
			const loadNotes=async(showHidden=false)=>
				{
					let notesQuery;
					if(showHidden)
					{
						notesQuery=query(collection(db, "notes"), orderBy("timestamp", "desc"));
					}
					else
					{
						notesQuery=query(collection(db, "notes"), where("visibility", "==", "visible"), orderBy("timestamp", "desc"));
					}
					const querySnapshot=await getDocs(notesQuery);
					notesList.innerHTML="";
					querySnapshot.forEach((doc)=>
						{
							const data=doc.data();
							const noteElement=document.createElement("div");
							noteElement.classList.add("note");
							noteElement.innerHTML=`<p style="font-weight: 500;">${data.content}</p><p style="float: right;">${data.date}</p><br>`;
							notesList.appendChild(noteElement);
						});
				};
			loadNotes(false);
		</script>
	</body>
</html>
